<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title>GMTools管理系统</title>
<link rel="stylesheet" type="text/css" href="css/style.css" media="all" />
<link rel="stylesheet" type="text/css" href="form/css/jqtransform.css" media="all" />
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="form/js/jquery.jqtransform.js"></script>
<script src="js/jquery.cookie.js"></script>
<script type="text/javascript" src="My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="js/template-native.js"></script> 
<script src="js/layer/layer.js"></script>
<script type="text/javascript">
$(function() {
    $(".jqtransform").jqTransform();
});
</script>
</head>

<body>


<!--jm-maincon warp start-->
<div class="jm-maincon">
    <div class="jm-plr15">
        <!-- jm-navbar start-->
        <div class="jm-navbar">
            <div class="jmform-search clearfix">
                 <form action="">                 	               
                    <div  class="top" style="width: 100%;float: left;">
                        <span id="totalHtml">
                            <script id="totalinfo" type="text/html">
                                <div class="jmform-group">
                                    系统rtp(百分比，低充值玩家)：
                                    <input id="system_rtp_launch" type="text" class="jminput jminput-size05" name="system_rtp_launch" value="<%=sysrtp?dataaction(sysrtp):0%>" />
                                </div>
                                <div class="jmform-group">
                                    系统rtp(百分比，一般玩家)：
                                    <input id="system_rtp_nolaunch" type="text" class="jminput jminput-size05" name="system_rtp_nolaunch" value="<%=regrtp?dataaction(regrtp):0%>" />
                                </div>
                                <div class="jmform-group">
                                    <a id="gm_log_searchBtn" class="jmbtn jmbtn-info" href="javascript:;" onclick="submit(2)">修改</a>
                                </div>
                            </script>
                            
                        </span>
                    </div>
                    <div>
                        <div class="jmform-group">
                            <div class="fleft">
                                <select id="search_sub_game" class="select_new">
                                                                        
                                </select>
                            </div>
                        </div>  
                        <!-- <div class="jmform-group">
                            <div class="jqtransform fleft">
                                <select id="search_sessions" name="select" style="width:150px;">
                                    <option value="0" selected>场次</option>                                
                                    <option value="1">初级场</option>
                                    <option value="2">中级场</option>
                                    <option value="3">高级场</option> 
                                    <option value="4">不入库存</option>                                           
                                </select>
                            </div>
                        </div>       -->
                        
                        <div class="jmform-group">
                            <a id="gm_log_searchBtn" class="jmbtn jmbtn-succeed" href="javascript:research(1)"><span class="ico-search-w16"></span>查询</a>
                        </div>
                    </div>
                </form>
            </div>           
        </div>
        <!-- jm-navbar end-->
        
        
        <div class="jm-TabTitle mt10">
            <h3 class="h3type txt-white">slots配置信息</h3>
        </div>
        <!-- jm-section start-->
        <div class="jm-section">
            <table class="jmtable-type01" id="cc_loginprops_table">
                <thead>
                    <tr>
                        <th>游戏</th>
                        <!-- <th>场次</th> -->
                        <th>奖池ID</th>
                        <th>实际奖池金额</th>
                        <th>入池比例(万分比)</th>
                        <th>爆池周期(秒)</th>
                        <th>最低虚拟爆池金额</th>
                        <th>虚拟奖池金额</th>
                        <th>虚拟奖池金额增长比例(万分比)区间</th>
                        <!-- <th>非充值rtp</th> -->
                        <th>低充值rtp</th>
                        <th>充值rtp</th>
                        <th>房间累计盈利</th>
                        <th>最低准入金额</th>
						<th>操作</th>
                    </tr>
                </thead>               
                <tbody id="gm_cc_RecordHtml">
                	<script id="gm_cc_RecordData" type="text/html">
						<%for(i = 0; i < datas.length; i++) {%>    
						<tr subgameid=<%=datas[i].subgameid%> subgametype=<%=datas[i].subgametype??0%>  addpoolper=<%=datas[i].addrealpoolper??0%> bomblooptime=<%=datas[i].bomblooptime??0%> minbombchips=<%=datas[i].standardchips??0%> fakepooladdmin=<%=datas[i].fakepoolmin??0%> fakepooladdmax=<%=datas[i].fakepoolmax??0%> rebateparam=<%=datas[i].rebatevalue??0%> norechargertp=<%=datas[i].norechargertp??0%> lowrechargertp=<%=datas[i].lowrechargertp??0%> limitchips=<%=datas[i].limitlow??0%> realpoolchips=<%=datas[i].realpoolchips??0%> poolId=<%=datas[i].poolId??0%>>
							<td><%=gamename(datas[i].subgameid)%></td>
							<!-- <td><%=sessionsname(datas[i].subgametype)%></td> -->
                            <td><%=datas[i].poolId %></td>
                            <td><%=dataaction(datas[i].realpoolchips)%></td>
							<td><%=datas[i].addrealpoolper%></td>
							<td><%=datas[i].bomblooptime%></td>

							<td><%=dataaction(datas[i].standardchips)%></td>
							<td><%=dataaction(datas[i].fakepoolchips)%></td>
							<td><%=datas[i].fakepoolmin%>-<%=datas[i].fakepoolmax%></td>
                            <!-- <td><%=dataaction(datas[i].norechargertp)%>%</td> -->
							<td><%=dataaction(datas[i].lowrechargertp)%>%</td>
                            <td><%=dataaction(datas[i].rebatevalue)%>%</td>
                            
							<td><%=dataaction(datas[i].totalprofit)%></td>
                            <td><%=dataaction(datas[i].limitlow)%></td>
							<td><a class='releaseBtn' style="color:blue;">修改</a></td>
						</tr>
						<%}%>
					</script>
                </tbody>
            </table>
        </div>
        <!-- jm-section end-->
        <div class="jm-navbar clearfix">
            <!-- jm-epages -->
            <!-- <div class="jm-epages" id="pageHtml">
            	<script type="text/html" id="pageData">
				<%if(isenptydata(datas)){%>
					<div style="color:#ff6600" class="fleft">暂无查询记录！</div>
				<%} else{%>
					<div class = "fright">
					<%if(curpage != 1) {%>   
						<a href="javascript:listToPage(1);">首页</a>
						<a href="javascript:listToPage(<%=curpage - 1%>);">上一页</a>
					<%}%>
					<%if(curpage == 1 && maxpage != 0 && maxpage != 1) {%>  
						<a>首页</a>
						<a>上一页</a>
					<%}%>				
					<%if(maxpage <= 8){%> 
						<%for(i = 1; i <= maxpage; i++) {%>  
						<%if(curpage == i) {%>  
							<a href="#" class="on"><%=i%></a>  
						<%}else {%>  
							<a href="javascript:listToPage(<%=i%>);"><%=i%></a>  
						<%}%>  
					<%}%>  
					<%}else {%>  
						<%if(curpage == 1) {%>  
							<a href="#" class="on">1</a>  
							<a href="javascript:listToPage(2);">2</a>  
							<a href="javascript:listToPage(3);">3</a>  
							...  
							<a href="javascript:listToPage(<%=maxpage - 1%>);"><%=maxpage - 1%></a>  
							<a href="javascript:listToPage(<%=maxpage%>);"><%=maxpage%></a>  
						<%}else if(curpage < 6) {%>  
							<%for(i = 1; i <= curpage - 1; i++ ) {%>  
								<a href="javascript:listToPage(<%=i%>);"><%=i%></a>  
							<%}%>  
							<span class="on"><%=curpage%></span>  
							<a href="javascript:listToPage(<%=curpage + 1%>);"><%=curpage + 1%></a>  
							...  
							<a href="javascript:listToPage(<%=maxpage - 1%>);"><%=maxpage - 1%></a>  
							<a href="javascript:listToPage(<%=maxpage%>);"><%=maxpage%></a>  
						<%}else if(curpage >= 6 && curpage < maxpage - 4) {%>  
							<a href="javascript:listToPage(1);">1</a>  
							<a href="javascript:listToPage(2);">2</a>  
							...  
							<a href="javascript:listToPage(<%=curpage - 1%>);"><%=curpage - 1%></a>  
							<span class="on"><%=curpage%></span>  
							<a href="javascript:listToPage(<%=curpage + 1%>);"><%=curpage + 1%></a>  
							...  
							<a href="javascript:listToPage(<%=maxpage-1%>);"><%=maxpage - 1%></a>  
							<a href="javascript:listToPage(<%=maxpage%>);"><%=maxpage%></a>  
						<%}else {%>  
							<a href="javascript:listToPage(1);">1</a>  
							<a href="javascript:listToPage(2);">2</a>  
							...  
							<%for(i = maxpage - 4; i <= maxpage; i++) {%>  
								<%if(curpage == i) {%>  
									<span class="on"><%=i%></span>  
								<%}else {%>  
									<a href="javascript:listToPage(<%=i%>);"><%=i%></a>  
								<%}%>  
							<%}%>  
						<%}%>  
					<%}%>  
					<%if(curpage < maxpage) {%>  
						<a href="javascript:listToPage(<%=curpage + 1%>);">下一页</a>  
						<a href="javascript:listToPage(<%=maxpage%>);">尾页</a>  
					<%}%> 
					<div>
				<%}%>
				</script>
            </div> -->
            <!-- epages -->
        </div>
        
    </div>
</div>
<!--jm-maincon warp end-->

<!-- 弹窗信息 start -->
<div id="itemInfo" style="overflow-y: auto;width: 700px;" class="popupCon " sty>
    <h2 class="f16 newTitle" >slots设置</h2>
    <a href="javascript:closeCont('itemInfo');"   class="btnClose">×</a>
    <!--popupBox start-->
    <div class="popupBox" >
        <div class="blockbox" >
            <div class="box-inner clearfix" style="min-height:300px">
                <div class="jmform-vertical add-itemInfo">
                    <div class="jmform-vgroup">
                        <label class="control-label" style="width: 25%;">游戏：</label>
                        <div class=" fleft">
							<select id="sub_game" name="select" class="select_new" >
                            	                                    
                            </select>
                        </div>
                    </div>
                    <!-- <div class="jmform-vgroup">
                        <label class="control-label" style="width: 25%;">场次：</label>
                        <div class=" fleft">
                            <select id="sessions" name="select" class="select_new">
                                <option value="0">请选择场次</option>
                                <option value="1">初级场</option>
                                <option value="2">中级场</option>
                                <option value="3">高级场</option>
                            </select>
                        </div>
                    </div> -->
                    <div class="jmform-vgroup">
                        <label class="control-label" style="width: 25%;">实际奖池金额：</label>
                        <div class="fillform">
                            <input id="realpoolchips" type="text" class="jminput jminput-size05" name="target_stock" />
                        </div>
                    </div>
                    <div class="jmform-vgroup">
                        <label class="control-label" style="width: 25%;">入池比例(万分比)：</label>
                        <div class="fillform">
                            <input id="pool_ratio" type="text" class="jminput jminput-size05" name="target_stock" />
                        </div>
                    </div>
                    <div class="jmform-vgroup">
                        <label class="control-label" style="width: 25%;">爆池周期(秒)：</label>
                        <div class="fillform">
                            <input id="pool_cycle" type="text" class="jminput jminput-size05" name="real_stock" />
                        </div>
                    </div>
                    <div class="jmform-vgroup">
                        <label class="control-label" style="width: 25%;">最低虚拟爆池金额:</label>
                        <div class="fillform">
                            <input id="pool_gold" type="text" class="jminput jminput-size05" name="pumping_ratio" />
                        </div>
                    </div>
                    <div class="jmform-vgroup">
                        <label class="control-label" style="width: 25%;">虚拟奖池金额增长比例(万分比)：</label>
                        <div class="fillform" style="width: 30%;">
                            <input id="pool_ratio_lower" type="text" class="jminput jminput-size05" name="attenuation_form" style="width: 30%;"/>-
                            <input id="pool_ratio_upper" type="text" class="jminput jminput-size05" name="attenuation_form" style="width: 30%;"/>
                        </div>
                    </div>
                    
                    <!-- <div class="jmform-vgroup">
                        <label class="control-label" style="width: 25%;">非充值rtp：</label>
                        <div class="fillform">
                            <input id="norechargertp" type="text" class="jminput jminput-size05" name="lowest_gold" />
                        </div>
                    </div> -->
                    <div class="jmform-vgroup">
                        <label class="control-label" style="width: 25%;">低充值rtp</label>
                        <div class="fillform">
                            <input id="lowrechargertp" type="text" class="jminput jminput-size05" name="lowest_gold" />
                        </div>
                    </div>
                    <div class="jmform-vgroup">
                        <label class="control-label" style="width: 25%;">充值rtp</label>
                        <div class="fillform">
                            <input id="reward" type="text" class="jminput jminput-size05" name="lowest_gold" />
                        </div>
                    </div>
                    <div class="jmform-vgroup">
                        <label class="control-label" style="width: 25%;">最低准入金额：</label>
                        <div class="fillform">
                            <input id="lowest_gold" type="text" class="jminput jminput-size05" name="lowest_gold" />
                        </div>
                    </div>
                    <div class="jmform-vgroup jm-ptb20">
                        <div class="control-label clearfix">  
                        	                      	
                        </div>
                        <div class="fillform"> 
                        	<a class="jmbtn jmbtn jmbtn-info" href="javascript:void(0)" onclick="submit(1)">提交</a>  
							<a class="jmbtn jmbtn jmbtn-default" href="javascript:closeCont('itemInfo');">取消</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <!--popupBox end-->
</div>


<script type="text/javascript" src="js/effect.js"></script>
<!--报表导出 js -->
<script src="js/export/tableExport.js"></script>
<script src="js/export/jquery.base64.js"></script>
<style>
.select_new{
  width:150px;height:36px; border:1px solid #ddd;border-radius: 5px;color: #555555
}
</style>
<script type="text/javascript">
	var sub_game_old = 0;
	var sessions_old = 0;
	var pool_ratio_old       = 0;
	var pool_cycle_old       = 0;
	var pool_gold_old        = 0;
	var pool_ratio_lower_old = 0;
	var pool_ratio_upper_old = 0;
	var reward_old = 0;
	var lowest_gold_old    = 0;
    var lowrechargertp_old = 0;
    var norechargertp_old = 0;

    var perpage=  50;
    var curpage = 1;
    var jsonPlat ;
    var realpoolchips_old = 0;
    var poolId = 0;

    template.helper('gamename', function (data) {    
        for(var i=0; i<jsonPlat.length; i++) {
            if(jsonPlat[i].subgameid == data){
               return jsonPlat[i].subgamename;
               break;
            }
        }
   	})
    template.helper('sessionsname', function (data) {    
   		switch(data){
			case 1:
				return "初级场";
			case 2:
				return "中级场";
			case 3:
				return "高级场";
            case 4:
				return "不入库存";   
		}
   	})
    template.helper('dataaction', function (data) {    
   		
        return (data/100).toFixed(2)
   	})
    //判断是否有数据，记录为空
    template.helper('isenptydata', function (data) {
        if($.isEmptyObject(data)){
            return true;
        }else{
            return false;
        }
    })
    function research(id) {
        var gameid = Number($.cookie("gameid")) || 0;
        var zoneid = Number($.cookie("zoneid")) || 0;
        let sub_game = Number($('#search_sub_game').val());
        let sessions = Number($('#search_sessions').val());
        
		var stId =  Number(id);
		var toCurPage = stId ||1;
        
        var onLoadTip;	
		$.ajax({
			type: "post",
			url:"/gm/http",
			data:{cmd: "game_slots_list", gameid: gameid,zoneid:zoneid, type: 1, sub_game:sub_game, sessions:sessions,curpage: toCurPage , perpage :perpage},
			dataType:"json",
			beforeSend: function(){
				//加载中...提示
				 onLoadTip = layer.load(1);
				},
			success: function(data){
				//有返回值,则关闭加载
				layer.close(onLoadTip);
				if (!data) {
					alert("command timeout");
				} else {
					if (data.datas&&data.datas.length>0) {
                        var html = template("gm_cc_RecordData", data); 
                        $("#gm_cc_RecordHtml").html(html);
                    }else{
                        $("#gm_cc_RecordHtml").html("");
                    } 
                    curpage = data.curpage;
					
                    var totalHtml = template("totalinfo", data);  
					$("#totalHtml").html(totalHtml);
				}
			}
		});
    }
	function listToPage(id){
		var ids = id
		research(ids);
		};
    $(document).ready(function(){

        research(1);
        
		let gameid = $.cookie("gameid");
		
		$.getJSON("js/json/game/1002.json", function(allplat){
			jsonPlat = eval(allplat.data);
			var html = " <option value='0'>请选择游戏</option>";
			for(var i=0; i<jsonPlat.length; i++) {
				if(jsonPlat[i].gametype == 1){
					html += "<option value='"+jsonPlat[i].subgameid+"'>"+jsonPlat[i].subgamename+"</option>";
				}
				
			}
			$("#search_sub_game").html(html)
			$("#sub_game").html(html)
		});	
        // research();
		
    });
	$('.releaseBtn').live('click',function(){

        var trItem = $(this).parent('td').parent('tr');
        sub_game_old = trItem.attr("subgameid");
        sessions_old = trItem.attr("subgametype");
        pool_ratio_old       = trItem.attr("addpoolper");
        pool_cycle_old       = trItem.attr("bomblooptime");
        pool_gold_old        = (trItem.attr("minbombchips")/100).toFixed(2);
        pool_ratio_lower_old = trItem.attr("fakepooladdmin");
        pool_ratio_upper_old = trItem.attr("fakepooladdmax");
        reward_old = (trItem.attr("rebateparam")/100).toFixed(2);
        lowest_gold_old    = (trItem.attr("limitchips")/100).toFixed(2);
        realpoolchips_old =  (trItem.attr("realpoolchips")/100).toFixed(2);
        poolId =  trItem.attr("poolId");
        lowrechargertp_old = (trItem.attr("lowrechargertp")/100).toFixed(2);
        norechargertp_old = (trItem.attr("norechargertp")/100).toFixed(2);


        $("#sub_game").find("option[value="+sub_game_old+"]").attr("selected",true);
        $("#sub_game").attr("disabled" , true)
        $("#sessions").find("option[value="+sessions_old+"]").attr("selected",true);
        $("#sessions").attr("disabled" , true)
        $('#pool_ratio').val(pool_ratio_old);
        $('#pool_cycle').val(pool_cycle_old);
        $('#pool_gold').val(pool_gold_old);
        $('#pool_ratio_lower').val(pool_ratio_lower_old);
        $('#pool_ratio_upper').val(pool_ratio_upper_old);
        $('#reward').val(reward_old);
        $('#lowest_gold').val(lowest_gold_old);
        $('#realpoolchips').val(realpoolchips_old);
        $('#lowrechargertp').val(lowrechargertp_old);
        $('#norechargertp').val(norechargertp_old);

		showCont('itemInfo');

	})
	function submit(num){
        let gameid = $.cookie("gameid");
        let zoneid = $.cookie("zoneid");
        if(num == 1){
            let sub_game = Number($('#sub_game').val());
            let sessions = Number($('#sessions').val());

            if(sub_game == 0 || sessions == 0){
                alert("请选择正确的游戏和场次");
                return false;
            }
            let pool_ratio      = Number($('#pool_ratio').val());
            let pool_cycle      = Number($('#pool_cycle').val());
            let pool_gold       = Number($('#pool_gold').val()* 100) ;
            let pool_ratio_lower = Number($('#pool_ratio_lower').val());
            let pool_ratio_upper = Number($('#pool_ratio_upper').val());
            let reward = Number($('#reward').val() * 100 ) ;
            let lowest_gold    = Number($('#lowest_gold').val() * 100);
            let realpoolchips      = Number($('#realpoolchips').val() * 100);
            let lowrechargertp = Number($('#lowrechargertp').val() * 100 ) ;
            let norechargertp = Number($('#norechargertp').val() * 100 ) ;

            // if(!(pool_ratio && pool_cycle && pool_gold && pool_ratio_lower && pool_ratio_upper && reward && lowest_gold)){
            //     alert("请输入正确的参数");
            //     return false; 
            // }
            
            if(sub_game == sub_game_old && sessions == sessions_old && pool_ratio == pool_ratio_old && pool_cycle == pool_cycle_old && pool_gold == pool_gold_old  && pool_ratio_lower == pool_ratio_lower_old &&  pool_ratio_upper == pool_ratio_upper_old &&reward == reward_old &&lowest_gold==lowest_gold_old && realpoolchips == realpoolchips_old  && lowrechargertp == lowrechargertp_old  && norechargertp == norechargertp_old){
                alert("数据没有任何修改");
                return false;
            }

            let res = confirm('是否确认提交？');
            if(res != true) {
                return;
            }

            $.post("/gm/http", {cmd: "game_slots_list", gameid: gameid,zoneid:zoneid, type: 2, sub_game:sub_game, sessions:sessions, pool_ratio:pool_ratio, pool_cycle:pool_cycle,pool_gold:pool_gold, pool_ratio_lower:pool_ratio_lower, pool_ratio_upper:pool_ratio_upper,reward:reward,lowest_gold:lowest_gold, curpage: curpage , perpage :perpage,realpoolchips:realpoolchips,poolId:poolId,lowrechargertp:lowrechargertp,norechargertp:norechargertp},
            function(data){
                alert(data.retdesc);
                if(data.retcode == 0){
                    listToPage(curpage);
                }
            }, "json");
        }else{
            let system_rtp = Number($('#system_rtp_launch').val() * 100);
            let system_rtp_nolaunch = Number($('#system_rtp_nolaunch').val() * 100);

            $.post("/gm/http", {cmd: "game_slots_list", gameid: gameid,zoneid:0, type: 3,system_rtp:system_rtp , system_rtp_nolaunch:system_rtp_nolaunch},

            function(data){
                
                alert(data.retdesc);
                if(data.retcode == 0){
                    listToPage(curpage);
                }
            }, "json");
        }
 
    }
</script>
</body>
</html>